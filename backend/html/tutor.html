<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Tutor - ITS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tutor-container {
            max-width: 700px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: center;
        }
        .problem-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }
        .problem-display .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }
        .problem-display .equation {
            font-size: 32px;
            font-weight: 600;
            color: #333;
            font-family: 'Courier New', monospace;
        }
        .work-area {
            margin-bottom: 20px;
        }
        .work-area label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        .canvas-container {
            border: 3px solid #667eea;
            border-radius: 12px;
            background: white;
            padding: 15px;
            min-height: 150px;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            border: none;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            outline: none;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        button {
            flex: 1;
            padding: 16px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-stuck {
            background: #ffc107;
            color: #000;
        }
        .btn-stuck:hover {
            background: #ffb300;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
        }
        .btn-done {
            background: #4caf50;
            color: white;
        }
        .btn-done:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        .btn-new {
            background: #667eea;
            color: white;
        }
        .btn-new:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .hint-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            display: none;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease;
        }
        .hint-box.show {
            display: block;
        }
        .hint-box .hint-label {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
            text-transform: uppercase;
        }
        .hint-box .hint-text {
            color: #333;
            font-size: 16px;
            line-height: 1.6;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .kc-info {
            background: #e3f2fd;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            color: #1976d2;
            text-align: center;
            margin-bottom: 20px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #ffc107;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .problem-selector {
            margin-bottom: 20px;
        }
        .problem-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="tutor-container">
        <h1>üéì Algebra Problem Solver</h1>
        
        <div class="problem-selector">
            <select id="problemSelect" onchange="loadProblem()">
                <option value="x - 7 + 3 = 5">x - 7 + 3 = 5</option>
                <option value="3y + 9 = 13">3y + 9 = 13</option>
                <option value="2x = 10">2x = 10</option>
                <option value="x + 5 = 10">x + 5 = 10</option>
                <option value="-5 - 11w = -8 - 8w">-5 - 11w = -8 - 8w</option>
            </select>
        </div>

        <div class="problem-display">
            <div class="label">Problem to Solve:</div>
            <div class="equation" id="problemEquation">x - 7 + 3 = 5</div>
        </div>

        <div id="kcInfo" class="kc-info" style="display: none;"></div>

        <div class="work-area">
            <label>Your Work:</label>
            <div class="canvas-container">
                <textarea id="workCanvas" placeholder="Show your work here...&#10;&#10;Example:&#10;x - 7 + 3 = 5&#10;x - 4 = 5&#10;x - 4 + 4 = 5 + 4&#10;x = 9"></textarea>
            </div>
        </div>

        <div id="hintBox" class="hint-box">
            <div class="hint-label">üí° Hint</div>
            <div class="hint-text" id="hintText"></div>
        </div>

        <div class="button-group">
            <button class="btn-stuck" onclick="getHelp()">‚ùì I'm Stuck</button>
            <button class="btn-done" onclick="checkSolution()">‚úì Check Answer</button>
            <button class="btn-new" onclick="newProblem()">‚ü≥ New Problem</button>
        </div>
    </div>

    <script>
        let currentProblem = "x - 7 + 3 = 5";
        let currentKC = null;
        let hintIndex = 0;
        let allHints = [];

        function loadProblem() {
            const select = document.getElementById('problemSelect');
            currentProblem = select.value;
            document.getElementById('problemEquation').textContent = currentProblem;
            document.getElementById('workCanvas').value = '';
            document.getElementById('hintBox').classList.remove('show');
            document.getElementById('kcInfo').style.display = 'none';
            hintIndex = 0;
            allHints = [];
        }

        async function getHelp() {
            const hintBox = document.getElementById('hintBox');
            const hintText = document.getElementById('hintText');
            
            // Show loading
            hintText.innerHTML = '<div class="loading"><div class="spinner"></div>Getting hint...</div>';
            hintBox.classList.add('show');

            try {
                const response = await fetch('http://localhost:8080/get_hints', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        problem: currentProblem,
                        step_type: ''
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                
                // Store KC info
                currentKC = data.kc;
                if (currentKC) {
                    document.getElementById('kcInfo').textContent = 
                        `KC: ${currentKC.category} | Difficulty: ${currentKC.difficulty} | Success Rate: ${(currentKC.success_rate * 100).toFixed(0)}%`;
                    document.getElementById('kcInfo').style.display = 'block';
                }

                // Store all hints
                allHints = data.hints || [];
                
                // Show ONE hint at a time
                if (allHints.length > 0) {
                    const hint = allHints[hintIndex % allHints.length];
                    hintText.textContent = hint.text;
                    hintIndex++;
                } else {
                    // Generic hint based on KC
                    hintText.textContent = getGenericHint();
                }

            } catch (error) {
                hintText.innerHTML = `<span style="color: #d32f2f;">Error: ${error.message}<br>Make sure the server is running: python3 rag_server.py</span>`;
            }
        }

        function getGenericHint() {
            const hints = [
                "Think about what operation will isolate the variable.",
                "Remember to do the same thing to both sides of the equation.",
                "What's being done to the variable? Do the opposite to undo it.",
                "Start by simplifying each side if possible.",
                "Look at what's added or subtracted from the variable first."
            ];
            return hints[Math.floor(Math.random() * hints.length)];
        }

        function checkSolution() {
            const work = document.getElementById('workCanvas').value;
            if (!work.trim()) {
                alert('Please show your work first!');
                return;
            }
            
            alert('Great work! In a real system, this would check your answer.\n\nFor now, verify your solution by substituting back into the original equation.');
        }

        function newProblem() {
            const select = document.getElementById('problemSelect');
            const currentIndex = select.selectedIndex;
            const nextIndex = (currentIndex + 1) % select.options.length;
            select.selectedIndex = nextIndex;
            loadProblem();
        }

        // Load initial problem
        loadProblem();
    </script>
</body>
</html>

